# カスタムアダプター

Sailsでは、独自のデータベースアダプターを簡単に作成できます。カスタムアダプターは、あなたのアプリ（`api/adapters/`）に直接作成することも、NPMパッケージとして公開することもできます。[カスタムアダプターの導入](https://github.com/balderdashy/sails-docs/blob/master/contributing/intro-to-custom-adapters.md)と[アダプターインターフェースのリファレンス](https://github.com/balderdashy/sails-docs/blob/master/contributing/adapter-specification.md)、それから[sails-adapter-boilerplate](https://github.com/balderdashy/sails-adapter-boilerplate)で、独自のアダプターを作成するための詳細情報をチェックしましょう。


### アダプターはどこにあるのですか？

2つの違う場所にアダプターを作成できます。

##### アプリケーションの`api/adapters/`フォルダ

アダプターが1つのアプリケーション（たとえば、既存のアダプターの短期間のフォーク）でのみ使用される場合は、そのアダプターを`api/adapters/`に入れることができます。`sails generate adapter`を実行すればすぐに生成されるものです。この場合、アダプターの名前は、`api/adapter/`内のフォルダの名前によってきます。（規約により、アダプターのエントリーポイントが`index.js`となる必要があります。）

##### 別のリポジトリ

複数のSailsアプリケーションでアダプターを共有する場合は、組織内に使うものかどうか、Sails/Node.jsコミュニティの他のメンバーのためのオープンソースパッケージかどうかに関係なく、このオプションを使用することをお勧めします。このような外部のアダプターを使用するには、`npm install your-adapter-package-name`または`npm link your-adapter-package-name`を実行する必要があります。

> オープンソースのアダプターを始める前に、プロジェクトがすでに存在しているか調べるために、`sails-databasename`と`waterline-databasename`でGithubを検索してみることをお勧めします、もしあるのであれば、既存のアダプターの作成者に連絡を取り、新しいプロジェクトを始める代わりにコントリビュートするのが、一般的には良い考え方です。ほとんどの開発者は助けを歓迎するでしょうし、その結果より良い品質のアダプターが得られるかもしれません。存在しない場合は、`sails-databasename`という規約に従った名前で新しいプロジェクトを作成することをお勧めします。


### カスタムアダプターには何が入っていますか？

Sailsでは、データベースアダプターは **インターフェース** を公開しています。インターフェースは、特定の機能を実装するという約束を意味します。これにより、複数のモデル、開発者、アプリケーション、さらには企業の従来の使用パターンを保証し、アプリケーションコードのメンテナンス性、効率性、信頼性を向上させることができます。アダプターは主にデータベースとの統合に役立ちますが、純粋なRESTfulオープンAPI、もしくは内部/独自のWebサービスをサポートするためにも使用できます。

> すべてがRESTful/CRUDの骨組みに完全な適合をするわけではありません。時には、統合しているサービスに、RPC方式のインターフェイスがあり、専用の方法があります。たとえば、メールを送信したり、接続されたハードウェア上のリモートセンサーを読み取ったりするAPIリクエストを考えてみましょう。そのためには、マシンパックを作成したり拡張したりしたいと思うでしょう。[マシンパックについての詳細はここで確認してください。](http://node-machine.org)

### アダプターではどんなことができますか？

アダプターは、主に、モデル・コンテキスト化されたCRUDメソッドを提供することに重点を置いています。CRUDは、作成、読み取り、更新、および削除を表します。Sails/Waterlineでは、`create()`や`find()`、`update()`、そして`desctroy()`といったメソッドを呼び出します。

たとえば、`MySQLAdapter`は`create()`というメソッドを実装していて、それは内部的に指定されたテーブル名と接続情報を使用してMySQLデータベースを呼び出し、`INSERT ...`のSQLクエリを実行します。

実際にやってみると、アダプターでなんでも好きなことをやることができます。あなたが書いたメソッドはすべて、生のデータストアオブジェクトとそれを使用するすべてのモデルに公開されます。

### カスタムアダプタの作成

[Sailsドキュメント](https://sailsguides.jp/doc)をチェックするか、新しいSailsプロジェクトでカスタムアダプターを設定する方法については、[`config/datastores.js`](https://sailsguides.jp/doc/anatomy/config/datastores-js)を参照してください。

#### テストの実行

アダプターの`package.json`ファイルで、サポートする予定のインターフェイス（およびSailsの対象バージョン）を設定します。

```javascript
{
  //...
  "sails": {
  	"adapter": {
	    "sailsVersion": "^1.0.0",
	    "implements": [
	      "semantic",
	      "queryable"
	    ]
	  }
  }
}
```

アダプターのディレクトリで次のコマンドを実行します。

```sh
$ npm test
```

#### アダプタを公開する

> 非公開のアダプターを作成し、それを好きなように使うことができます。
> 以下の手順は、オープンソースのアダプターをリリースするためのものです。

1. 新しいパブリックリポジトリを作成し、それをリモートとして追加する（ `git remote add origin git@github.com:yourusername/sails-youradaptername.git`）。
2. 自分自身を著者として設定し、package.jsonのライセンスを"MIT"に変更します。
3. テストを1度実行します。
4. [sails-docsへのプルリクエスト](https://github.com/balderdashy/sails-docs/edit/master/concepts/extending-sails/Adapters/adapterList.md)を行い、アダプターのリポジトリを追加してください。
5. 我々はあなたの新しいアダプターについての情報をドキュメントに反映させます。
6. 世界の人々が賞賛であなたを崇拝するようにしましょう。
7. `npm version patch`を実行します。
8. `git push && git push --tags`を実行します。
9. `npm publish`を実行します。

### カスタムアダプタが必要なのはなぜですか？

Sailsアプリケーションを構築する場合、別のハードウェアとの非同期通信の送受信は、技術的にアダプタに正規化することができます。（すなわちAPIとの統合です）

> **ウィキペディアから:**
> *http://en.wikipedia.org/wiki/Create,_read,_update_and_delete*

> リレーショナルデータベースはソフトウェアアプリケーションで共通の永続性レイヤを提供しますが、他の多くの永続化レイヤが存在します。CRUD機能は、オブジェクトデータベース、XMLデータベース、フラットテキストファイル、カスタムファイル形式、テープ、またはカードなどで実装できます。

言い換えれば、WaterlineはデータベースのORMであるとは限りません。LDAP、Neo4J、[ランプ](https://www.youtube.com/watch?v=OmcQZD_LIAE)など、あらゆる種類のRESTfulサービス、データソース、およびデバイスと統合する目的にとらわれないオープンな標準とツールセットです。

> **ただ、覚えておいてください。** 「作成」、「読み取り」、「更新」、および「破棄」インターフェースをサポートするデータベースおよびAPIとの通信のみに、Waterlineのアダプターを使用してください。すべてがその仕組みに適合するわけではなく、他のユースケースに対処するためのより優れた、より[一般的な方法](http://node-machine.org)があるでしょう。


### なぜカスタムアダプターを作成しなければならないのですか？

要約すると、アダプターとしてあなたのAPIの統合を書くことで、**簡単に**、**短時間で**、**リスクを低減し**、**標準化された規約のセット** の利点を得ることができ、**文書化されたAPI** と同じプロセスを経験した他の開発者の **コミュニティサポート** を得ることができるからです。何よりも、自分自身や自分のチームが **アダプターの再利用** を他のプロジェクトで行うことができ、**開発のスピードアップ** や **時間とお金の節約** につながります。

最後に、アダプターをオープンソースとしてリリースすることを選択した場合、私たちの小さなフレームワークと芽吹き始めたSails.jsエコシステムに大きな恩恵をもたらします。Sailsでなくても、以前にリポジトリをフォークした経験がなくても、OSSコミュニティにお返しすることをお勧めします。怖がらないでください、悪くはありません！

Sailsコミュニティが共同でオープンソースとしてリリースする高品質のアダプタであれば、さまざまなデータベースやサービスと統合する際に、すべての作業を繰り返す必要はありません。我々のビジョンは、サーバーサイドのアプリケーションの構築をもっと楽しく、繰り返す作業がより少ないものへとすることであり、同時にその結果として、コミュニティの統一されたアダプターやマシンパック、ドライバー、ジェネレーター、ビューエンジンや他のものが作られることです。

### アダプターインターフェイスとは何ですか？

データベースアダプターの機能は、接続するサービスと同じくらい多様です。つまり、メソッドの標準ライブラリがあり、サポートマトリックスを知っておく必要があります。アダプターは、以下のインターフェースの一部または全部を実装することもあれば実装しないこともありますが、**アダプターがインターフェース内に1つのメソッドを実装する場合は、すべてのインターフェースを実装する必要があります。** これは、制限や不完全な実装のために必ずしも当てはまるわけではありませんが、少なくとも、記述されたエラーメッセージを使用して、サポートされているものとされていないものを知らせる必要があります。

> 詳細については、Sailsのドキュメント、特に[アダプターインターフェイスのリファレンス](https://github.com/balderdashy/sails-docs/blob/master/contributing/adapter-specification.md)を参照してください。

### 参考になる例はありますか？

インスピレーションを求めているなら、コアアダプタで始めるのがよいでしょう。 **[MySQL](https://github.com/balderdashy/sails-mysql)** や、 **[PostgreSQL](https://github.com/balderdashy/sails-postgresql)**、 **[MongoDB](https://github.com/balderdashy/sails-mongo)**、 **[Redis](https://github.com/balderdashy/sails-redis)**、そして [ローカルディスク](https://github.com/balderdashy/sails-disk)を見てみてください。

### どこで助けを受けられますか？

GithubやStack Overflow、Googleグループ、IRC、そしてGitterなどに、SailsとWaterlineユーザーのアクティブなコミュニティが存在します。推奨事項の一覧については、[サポートページ](https://sailsjs.com/support)を参照してください。

> ここではカバーされていない未回答の質問があり、コミュニティーにとって価値があると思われる場合は、自由にPRを送って文書のこのセクションに追加してください。


<docmeta name="displayName" value="カスタムアダプター">
